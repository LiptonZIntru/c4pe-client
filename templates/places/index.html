{% extends 'layouts/layout.html' %}

{% block css %}
    {% load static %}
    <style>
        .collapsing {transition: none !important;}
        @media only screen and (max-width: 991px)
        {
            #responsiveBreak{
                display: none;
            }
            .mt-5{
                margin-top: 0 !important;
            }
        }
        @media only screen and (min-width: 768px)
        {
            #labelWrap{
                display: none;
            }
        }
        @media only screen and (min-width: 992px)
        {
            #line{
                display: none;
            }
        }
        hr {
            width: 100%;
            color: #FFFF00;
            height: 2px;
            margin-top: 0px;
        }
        #line {
            width: 90%;
            height: 10px;
            margin-left: 5%;
        }

    </style>
{% endblock %}

{% block title %}
    Browse
{% endblock %}

{% block content %}
      <div class="container my-3">                                                  <!-- dává prostor doleva a doprava, aby stránka měla okraje -->
          <div class="m-auto p-0" style="width: 300px;">                                                                     <!-- záhlaví stránky - velké logo a název podniku -->
            <a href="/" style="width: 300px;"><img src="{% static "img/PlacesToEat.svg" %}" class="mx-auto mb-4 d-block unselectable" alt="PlacesToEat.svg" style="width: 300px;"></a> <!-- alternate src="PlacesToEatInvertedBorder.svg" -->
          </div>
          <h3 class="text-center text-nowrap unselectable pb-2" style="font-family: 'Corbel'; font-size: 46px;"><i><b>What is your dream<b id="labelWrap"><br/></b> place?</b></i></h3>
          <form>
              <div class="input-group">
                  <input type="text" class="form-control" placeholder="Your favorite place is here">
                  <div class="input-group-append">
                      <button class="btn btn-primary" type="button">
                          <i class="fa fa-search"></i>
                      </button>
                  </div>
              </div>
          </form>
        <div class="row mt-3">
            <div class="col-lg-2 text-nowrap">
                <button type="button" class="btn btn-secondary mr-2" href="#filters" aria-expanded="false" aria-controls="writeReview" data-toggle="collapse" id="filtersToggler">
                    Show filters
                </button>
                <br id="responsiveBreak" hidden/>
                <button type="button" class="btn collapse border-primary text-primary mt-5 unselectable" id="filters">
                    Apply filters
                </button>
            </div>
            <div class="col-lg-10 mt-2 collapse row" id="filters">
                 <div class="col-lg-3 mb-2">
                     <label class="font-weight-bold text-nowrap" for="placeTypeFilter">Type of place:</label>
                     <div>
                         <div class="custom-control custom-control-inline custom-checkbox">
                           <input type="checkbox" class="custom-control-input" id="0.any" value="0.any" checked>
                           <label class="custom-control-label" for="0.any">any</label>
                         </div>
                         <br/>
                         {% for placetype in placetypes %}
                            <div class="custom-control custom-control-inline custom-checkbox">
                              <input type="checkbox" class="custom-control-input" id="{{ placetype.id }}.{{ placetype.name }}" value="{{ placetype.id }}.{{ placetype.name }}">
                              <label class="custom-control-label" for="{{ placetype.id }}.{{ placetype.name }}">{{ placetype.name }}</label>
                            </div>
                         {% endfor %}
                     </div>
                 </div>
                 <div id="line"><hr /></div>
                 <div class="col-lg-3 mb-2">
                     <div class="custom-control custom-checkbox">
                       <input type="checkbox" class="custom-control-input" id="openedOnly" onclick="toggleHide();" value="openedOnly">
                       <label class="custom-control-label" for="openedOnly">open places</label>
                     </div>
                     <div class="custom-control custom-checkbox pt-2">
                       <input type="checkbox" class="custom-control-input" id="noDataIncluding" value="noDataIncluding" disabled>
                       <label class="custom-control-label" for="noDataIncluding">"no data" state including</label>
                     </div>
                 </div>
                 <div id="line"><hr /></div>
                 <div class="col-lg-3 mb-2">
                     <div class="custom-control custom-checkbox">
                       <input type="checkbox" class="custom-control-input" value="testedFilter" id="testedFilter">
                       <label class="custom-control-label" for="testedFilter">tested by people (5 reviews and more)</label>
                     </div>
                 </div>
                 <div id="line"><hr /></div>
                 <div class="col-lg-2">
                     <label class="text-nowrap font-weight-bold">Rating:</label>
                     <div class="ml-3">
                         <div class="row pl-1">
                             <label class="pt-2 pr-2" for="ratingLowerRange">min:</label>
                             <input class="form-control" id="ratingLowerRange" type="number" value="5" min="0" max="5" step="1" style="width: 3.5em;"/>
                         </div>
                         <div class="row pt-2">
                             <label class="pt-2 pr-2" for="ratingUpperRange">max:</label>
                             <input class="form-control" id="ratingUpperRange" type="number" value="5" min="0" max="5" step="1" style="width: 3.5em;"/>
                         </div>
                     </div>
                 </div>
            </div>
        </div>
        <div class="list-group mt-1">                                                    <!-- seznam podniků -->
            {% for place in places %}
                  <x onclick="location.href='{{ place.id }}'" class="list-group-item list-group-item-action flex-column align-items-start rounded mt-3 unselectable" style="border-top-width: thin">
                     <div class="row">
                        <div class="col-md-2">                         <!-- fotka restaurace -->
                            <img src="https://cdn.pixabay.com/photo/2020/03/15/23/24/food-4935258_960_720.jpg" class="rounded-2 img-thumbnail img-responsive" alt="Place photo" style="width: 150px; vertical-align: center">
                        </div>
                        <div class="col-md-10">
                             <div class="d-flex w-100">
                                 <h3 class="mb-2 text-nowrap" style="cursor: default">{{ place.name }}</h3>            <!-- název místa -->
                             </div>
                            <p class="mb-0 text-nowrap" style="cursor: default">                                            <!-- typ místa -->
                                <b style="font-size: smaller">Type:</b> <x style="font-family: Consolas">{{ place.placeType.name }}</x>
                            </p>
                            <p class="mb-0 text-nowrap" style="cursor: default">                                            <!-- poloha místa -->
                                <b style="font-size: smaller">Location:</b> <x style="font-family: Consolas">{{ place.city }}</x> • <x id="street">{{ place.street }}</x> <y style="font-size: smaller">({{ place.country }})</y>
                            </p>
                            <p class="mb-0 text-nowrap" style="cursor: default" >                                            <!-- status - je potřeba dořešit dynamické zobrazení -->
                                {% if place.open.state == 1 %}
                                    <!--
                                    state 1: otevreno
                                    state 2: bude se otevirat
                                    state 3: bude se zavirat
                                    state 4: zavreno
                                    -->
                                    <b style="font-size: smaller">State:</b> <x class="text-success text-bold" style="font-size: medium"><b>opened</b></x>
                                {% elif place.open.state == 2 %}
                                    <b style="font-size: smaller">State:</b> <x class="text-warning text-bold" style="font-size: medium"><b>opened until {{ place.open.time }}</b></x>
                                {% elif place.open.state == 3 %}
                                    <b style="font-size: smaller">State:</b> <x class="text-warning text-bold" style="font-size: medium"><b>opening at {{ place.open.time }}</b></x>
                                {% elif place.open.state == 4 %}
                                    <b style="font-size: smaller">State:</b> <x class="text-danger text-bold" style="font-size: medium"><b>closed</b></x>
                                {% else %}
                                    <b style="font-size: smaller">State:</b> <x class="text-bold" style="font-size: medium"><b>no data</b></x>
                                {% endif %}
                            </p>
                        </div>

                         <a class="position-absolute" style="color: black; cursor: default; top: 10px; right: 14px;">                                       <!-- hodnocení -->
                              <small class="float-right">
                                  {% if place.rating|floatformat:"0" == "0" %}
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                  {% endif %}
                                  {% if place.rating|floatformat:"0" == "1" %}
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                  {% endif %}
                                  {% if place.rating|floatformat:"0" == "2" %}
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                  {% endif %}
                                  {% if place.rating|floatformat:"0" == "3" %}
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                  {% endif %}
                                  {% if place.rating|floatformat:"0" == "4" %}
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star-o"></i>
                                  {% endif %}
                                  {% if place.rating|floatformat:"0" == "5" %}
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                  {% endif %}
                              </small>
                              </br>
                             <small class="mb-0 mt-0 float-right text-nowrap" id="{{ place.id }}_uLine">
                                 <b>{{ place.rating|floatformat:"1" }} / 5</b> ({{ place.reviewCount }} reviews)
                             </small>
                         </a>
                        </div>
                  </x>
            {% endfor %}
        </div>

        <ul class="pagination justify-content-center mt-3 mb-4">
            {% if pages.last %}
                <li class="page-item "><a class="page-link" href="/places/?page={{ pages.content.1 }}">Previous</a></li><!-- pagination -->
            {% elif not pages.first %}
                <li class="page-item "><a class="page-link" href="/places/?page={{ pages.content.0 }}">Previous</a></li>
            {% endif %}
            {% for i in pages.content %}
                {% if i == pages.current %}
                    <li class="page-item active"><a class="page-link" href="/places/?page={{ i }}">{{ i }}</a></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="/places/?page={{ i }}">{{ i }}</a></li>
                {% endif %}
            {% endfor %}
            {% if pages.first %}
                <li class="page-item"><a class="page-link" href="/places/?page={{ pages.content.1 }}">Next</a></li>
            {% elif not pages.last %}
                <li class="page-item"><a class="page-link" href="/places/?page={{ pages.content.2 }}">Next</a></li>
            {% endif %}
        </ul>

      </div>
{% endblock %}

{% block js %}
<script>
    $(document).ready( function(){
        if(document.getElementById('openedOnly').checked) document.getElementById('noDataIncluding').disabled = false;
    });

    function toggleHide(){
        if(document.getElementById('noDataIncluding').disabled) document.getElementById('noDataIncluding').disabled = false;
        else
        {
            document.getElementById('noDataIncluding').disabled = true;
            document.getElementById('noDataIncluding').checked = false;
        }
    }

    $("#filters").on('shown.bs.collapse', function(){
        document.getElementById('filtersToggler').innerText = "Hide filters";
        document.getElementById('responsiveBreak').hidden = false;
      });

    $("#filters").on('hidden.bs.collapse', function(){
        document.getElementById('filtersToggler').innerText = "Show filters";
        document.getElementById('responsiveBreak').hidden = true;
      });
</script>
{% endblock %}